<!DOCTYPE html>
<html layout:decorate="~{Layout/layout_main}">
<head>
    <link rel="stylesheet" type="text/css" th:href="@{/board/css/board_content.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/board/css/modal.css}">
</head>
<div layout:fragment="content">
    <!-- feed list -->
    <div class="d-flex">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <input type="hidden" th:name="_csrf_header" th:value="${_csrf.headerName}"/>
        <div class="main-content d-flex justify-content-center">
            <div class="frag-main d-flex h-100">
                <div class="content-background">
                    <div class="frag-story mt-3">
                        스토리
                    </div>
                    <div class="frag-board mt-4">
                        <div th:each="feed, idx : ${feedList}" class="p-3 border-bottom">
                            <!--location not null-->
                            <div th:if="${feed.board.location == null}">
                                <div class="d-flex" style="padding: 0 0 12px 4px;">
                                    <div style="position: relative; width: 2.5rem; height: 2.5rem;">
                                        <img th:if="${feed.board.member.image == null}"
                                             id="none_user_img"
                                             src="/files/designImg/noneuser.png"
                                             class="shadow rounded-circle text-center"
                                             style="width: 100%; height: 100%; object-fit: cover;">
                                        <img th:unless="${feed.board.member.image == null}"
                                             th:src="@{|/resources/${feed.board.member.image.name}|}"
                                             class="shadow rounded-circle text-center"
                                             style="width: 100%; height: 100%; object-fit: cover;">
                                    </div>
                                    <div class="d-flex mx-2">
                                        <div class="d-flex justify-content-center align-items-center text-center">
                                            <div class="d-flex">
                                                <div style="font-weight: bold; font-size: medium"
                                                     th:text="${feed.board.member.username}"></div>
                                            </div>
                                            <div class="d-flex" style="font-size: smaller;">
                                                <span class="mx-2" dir="auto"
                                                      style="line-height: var(--base-line-clamp-line-height); --base-line-clamp-line-height: 18px;">•</span>
                                                <div th:text="${#temporals.format(feed.board.CreateDate, 'yyyy-MM-dd HH:mm:ss')}"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!--location null-->
                            <div th:if="${feed.board.location != null}">
                                <div class="d-flex" style="padding: 0 0 12px 4px;">
                                    <div style="position: relative; width: 2.5rem; height: 2.5rem;">
                                        <img th:if="${feed.board.member.image == null}"
                                             id="none_user_img"
                                             src="/files/designImg/noneuser.png"
                                             class="shadow rounded-circle text-center"
                                             style="width: 100%; height: 100%; object-fit: cover;">
                                        <img th:unless="${feed.board.member.image == null}"
                                             th:src="@{|/resources/${feed.board.member.image.name}|}"
                                             class="shadow rounded-circle text-center"
                                             style="width: 100%; height: 100%; object-fit: cover;">
                                    </div>
                                    <div class="d-flex flex-column mx-2">
                                        <div class="d-flex justify-content-center align-items-center text-center">
                                            <div class="d-flex">
                                                <div style="font-weight: bold; font-size: medium"
                                                     th:text="${feed.board.member.username}"></div>
                                            </div>
                                            <div class="d-flex" style="font-size: smaller;">
                                                <span class="mx-2" dir="auto"
                                                      style="line-height: var(--base-line-clamp-line-height); --base-line-clamp-line-height: 18px;">•</span>
                                                <div th:text="${#temporals.format(feed.board.CreateDate, 'yyyy-MM-dd HH:mm:ss')}"></div>
                                            </div>
                                        </div>
                                        <div class="d-flex" style="font-size: 0.8rem;">
                                            <div th:text="${feed.board.location.placeName}"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div th:id="@{|carouselExampleControlsNoTouching${idx.index}|}" class="carousel slide" data-bs-touch="false"
                                 data-interval="false">
                                <div class="carousel-inner">
                                    <div th:each="img , iterStat :${feed.images()}" class="carousel-item"
                                         style="position: relative; width: 37rem; height: 37rem;"
                                         th:classappend="${iterStat.index == 0} ? 'active'">
                                        <img th:id="${img.getId()}" th:src="@{|/resources/${img.name}|}" alt="..."
                                             class="shadow text-center rounded"
                                             style="width: 654px; height:100%;position: absolute; top: 0; left: 0; transform: translate(50,50); object-fit: cover; margin: auto">
                                    </div>
                                </div>
                                <button class="carousel-control-prev" type="button"
                                        th:classappend="${#lists.size(feed.images()) == 1 }? 'visually-hidden'"
                                        th:data-bs-target="'#carouselExampleControlsNoTouching'+${idx.index}"
                                        data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button"
                                        th:classappend="${#lists.size(feed.images()) == 1 }? 'visually-hidden'"
                                        th:data-bs-target="'#carouselExampleControlsNoTouching'+${idx.index}"
                                        data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            </div>

                            <div class="d-flex justify-content-between">
                                <div class="d-flex">
                                    <!-- Like -->
                                    <div class="p-2" role="button" tabindex="0">
                                        <!--개발중-->
                                        <a th:href="@{|/board/like/${feed.board.id}|}" onclick="toggleLikeIcon()">
                                            <svg aria-label="좋아요" class="unlike" fill="currentColor" height="24"
                                                 width="24"
                                                 role="img"
                                                 viewBox="0 0 24 24" style="color: black;">
                                                <path d="M16.792 3.904A4.989 4.989 0 0 1 21.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 0 1 4.708-5.218 4.21 4.21 0 0 1 3.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 0 1 3.679-1.938m0-2a6.04 6.04 0 0 0-4.797 2.127 6.052 6.052 0 0 0-4.787-2.127A6.985 6.985 0 0 0 .5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 0 0 3.518 3.018 2 2 0 0 0 2.174 0 45.263 45.263 0 0 0 3.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 0 0-6.708-7.218Z"></path>
                                            </svg>
                                            <svg aria-label="좋아요 취소" class="like" fill="currentColor"
                                                 height="24" width="24" role="img" viewBox="0 0 48 48"
                                                 style="color:red; display: none;">
                                                <path d="M34.6 3.1c-4.5 0-7.9 1.8-10.6 5.6-2.7-3.7-6.1-5.5-10.6-5.5C6 3.1 0 9.6 0 17.6c0 7.3 5.4 12 10.6 16.5.6.5 1.3 1.1 1.9 1.7l2.3 2c4.4 3.9 6.6 5.9 7.6 6.5.5.3 1.1.5 1.6.5s1.1-.2 1.6-.5c1-.6 2.8-2.2 7.8-6.8l2-1.8c.7-.6 1.3-1.2 2-1.7C42.7 29.6 48 25 48 17.6c0-8-6-14.5-13.4-14.5z"></path>
                                            </svg>
                                        </a>
                                    </div>
                                    <!-- Comment -->
                                    <a th:href="@{|/board/detail/${feed.board.id}|}">
                                        <div class="p-2" type="button" tabindex="0" data-bs-toggle="modal"
                                             data-bs-target="#selectFeedModal">
                                            <svg aria-label="댓글 달기" fill="currentColor" height="24" width="24"
                                                 role="img"
                                                 viewBox="0 0 24 24" style="color: black;">
                                                <path d="M20.656 17.008a9.993 9.993 0 1 0-3.59 3.615L22 22Z" fill="none"
                                                      stroke="currentColor" stroke-linejoin="round"
                                                      stroke-width="2"></path>
                                            </svg>
                                        </div>
                                    </a>
                                    <!-- share -->
                                    <div class="p-2" role="button" tabindex="0">
                                        <svg aria-label="게시물 공유"
                                             fill="currentColor" height="24" role="img" viewBox="0 0 24 24"
                                             width="24"><title>게시물 공유</title>
                                            <line fill="none" stroke="currentColor" stroke-linejoin="round"
                                                  stroke-width="2" x1="22" x2="9.218" y1="3" y2="10.083"></line>
                                            <polygon fill="none"
                                                     points="11.698 20.334 22 3.001 2 3.001 9.218 10.084 11.698 20.334"
                                                     stroke="currentColor" stroke-linejoin="round"
                                                     stroke-width="2"></polygon>
                                        </svg>
                                    </div>
                                </div>
                                <!-- save -->
                                <div class="d-flex">
                                    <div class="p-2" role="button" tabindex="0" data-bs-toggle="modal" data-bs-target="#BoardSaveModal">
                                        <svg aria-label="저장" fill="currentColor"
                                             height="24" role="img" viewBox="0 0 24 24" width="24"><title>저장</title>
                                            <polygon fill="none" points="20 21 12 13.44 4 21 4 3 20 3 20 21"
                                                     stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                                     stroke-width="2"></polygon>
                                        </svg>
                                    </div>
                                    <!-- BoardSaveModal -->
                                    <div class="modal fade" id="BoardSaveModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="BoardSaveModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <div class="d-flex justify-content-between align-items-center w-100">
                                                        <button class="btn-close m-0" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        <h1 class="modal-title fs-5 m-0" id="BoardSaveModalLabel">컬렉션</h1>
                                                        <button class="btn-close m-0" data-bs-target="#NewSaveGroupModal" data-bs-toggle="modal" style="transform: rotate(45deg);"></button>
                                                    </div>
                                                </div>
                                                <div class="modal-body">

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- BoardSaveModal End-->

                                    <!-- NewSaveGroupModal -->
                                    <div class="modal fade" id="NewSaveGroupModal" aria-hidden="true" aria-labelledby="NewSaveGroupModalLabel" tabindex="-1">
                                        <div class="modal-dialog modal-sm modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5" id="BoardSaveModal2Label">새 컬렉션</h1>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body d-flex align-items-center flex-column">
                                                    <div th:if="${idx.index}">
                                                        <div th:each="img : ${feed.images}" style="width: 10rem; height: 10rem;">
                                                            <img th:id="${img.getId()}" th:src="@{|/resources/${img.name}|}" alt="..." class="shadow text-center rounded"
                                                                 style="width:100%; height:100%; object-fit: cover; margin: auto">
                                                        </div>
                                                        <input type="text" class="form-control mt-3 w-100" placeholder="컬렉션 이름">
                                                    </div>
                                                </div>
                                                <div class="modal-footer p-0">
                                                    <div class="border-bottom text-center p-2 w-100">
                                                        <button type="button" class="btn btn-link text-dark" style="font-weight: bold;">저장</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
<!--                                <div class="d-flex">-->
<!--                                    <a th:href="@{|/board/saveGroup/${feed.board.id}|}">-->
<!--                                        <div class="p-2" role="button" tabindex="0">-->
<!--                                            <svg aria-label="저장" fill="currentColor"-->
<!--                                                 height="24" role="img" viewBox="0 0 24 24" width="24"><title>저장</title>-->
<!--                                                <polygon fill="none" points="20 21 12 13.44 4 21 4 3 20 3 20 21"-->
<!--                                                         stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"-->
<!--                                                         stroke-width="2"></polygon>-->
<!--                                            </svg>-->
<!--                                        </div>-->
<!--                                    </a>-->
<!--                                </div>-->
                            </div>
                            <div class="px-2" th:if="${feed.board.isLikeHide() == false}"
                                 th:text="'좋아요 ' + ${#lists.size(feed.board.boardLikeMemberMaps)} + '개'"></div>
                            <div class="px-2" th:if="${feed.board.isLikeHide() == true}"
                                 th:text="'좋아요 여러개 입니다.'"></div>
                            <div class="d-flex" style="width: 50%;">
                                <div class="px-2" th:text="${feed.board.member.username} + ${feed.board.content}"></div>
                            </div>

                            <!-- button show FeedCommentModal -->
                            <a th:href="@{|/board/detail/${feed.board.id}|}">
                                <button type="button" class="btn btn-link px-2 py-0" data-bs-toggle="modal"
                                        data-bs-target="#FeedCommentModal"
                                        th:text="${'댓글 ' + #lists.size(feed.comments)}+'개 보기'"></button>
                            </a>

                            <div th:classappend="${feed.board.isCommentDisable() == true}?'visually-hidden'">
                                <form th:action="@{|/comment/create/${feed.board.id}|}" method="post">
                                    <div class="d-flex">
                                        <textarea class="form-control border-0 me-2" style="resize: none;"
                                                  name="content"
                                                  id="content" placeholder="댓글 달기..."></textarea>
                                        <button type="submit" style="width: 10%;" class="btn btn-link">게시</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- feed list End-->


    <!--Board Detail Modal -->
    <div class="modal fade" id="FeedCommentModal" data-bs-backdrop="static"
         data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div th:if="${selectFeed}">
                        <div class="row mx-0">
                            <div class="col-7 p-0">
                                <div id="carousel-main" class="carousel slide" data-interval="false" data-bs-touch="false">
                                    <div class="carousel-inner">
                                        <div th:each="img, index : ${selectFeed.imageDTOS}"
                                             class="carousel-item"
                                             style="position: relative; width: 60rem; height: 50rem;"
                                             th:classappend="${index.index == 0} ? 'active'">
                                            <img th:src="@{|/resources/${img.name}|}"
                                                 alt="..."
                                                 class="shadow text-center"
                                                 style="width: 70%; height:100%;position: absolute; top: 0; left: 0; transform: translate(50,50); object-fit: cover; margin: auto">
                                        </div>
                                    </div>
                                    <button class="carousel-control-prev" type="button"
                                            data-bs-target="#carousel-main"
                                            th:classappend="${#lists.size(selectFeed.imageDTOS) == 1 }? 'visually-hidden'"
                                            data-bs-slide="prev">
                                                                <span class="carousel-control-prev-icon"
                                                                      aria-hidden="true"></span>
                                        <span class="visually-hidden">Previous</span>
                                    </button>
                                    <button class="carousel-control-next" type="button"
                                            data-bs-target="#carousel-main"
                                            th:classappend="${#lists.size(selectFeed.imageDTOS) == 1 }? 'visually-hidden'"
                                            data-bs-slide="next">
                                                                <span class="carousel-control-next-icon"
                                                                      aria-hidden="true"></span>
                                        <span class="visually-hidden">Next</span>
                                    </button>
                                </div>
                            </div>
                            <div class="col-5 p-0" style="height: 800px;">
                                <div class="d-flex align-items-center border-bottom"
                                     style="padding: 14px 16px 14px 16px; height: 10%;">
                                    <div class="d-flex align-items-center" style="flex:6;">
                                        <div class="me-3"
                                             style="position: relative; width: 2rem; height: 2rem;">
                                            <img th:if="${selectFeed.boardDTO.memberDTO.imageDTO == null || selectFeed.boardDTO.memberDTO.imageDTO.name == null || selectFeed.boardDTO.memberDTO.imageDTO.name.isEmpty()}"
                                                 id="none_user_img"
                                                 src="/files/designImg/noneuser.png"
                                                 class="shadow rounded-circle text-center"
                                                 style="position: absolute; top: 0; right: 0; width: 100%; height: 100%; object-fit: cover;">
                                            <img th:unless="${selectFeed.boardDTO.memberDTO.imageDTO == null || selectFeed.boardDTO.memberDTO.imageDTO.name == null || selectFeed.boardDTO.memberDTO.imageDTO.name.isEmpty()}"
                                                 th:src="@{|/resources/${selectFeed.boardDTO.memberDTO.imageDTO.name}|}"
                                                 class="shadow rounded-circle text-center"
                                                 style="position: absolute; top: 0; right: 0; width: 100%; height: 100%; object-fit: cover;">
                                        </div>
                                        <div class="d-flex justify-content-center align-items-center"
                                             style="font-weight:bold;"
                                             th:text="${selectFeed.boardDTO().memberDTO.username}"></div>
                                    </div>
                                    <div class="d-flex" style="flex:1;">
                                        <button type="button" class="btn btn-link"
                                                th:if="${selectFeed.boardDTO.memberDTO.username} == ${loginMember.username}"
                                                data-bs-toggle="modal"
                                                data-bs-target="#CreateUserBoardSettingModal">···
                                        </button>
                                        <!-- 다른 경우 exampleModal 버튼을 보여줍니다. -->
                                        <button type="button" class="btn btn-link"
                                                th:if="${selectFeed.boardDTO.memberDTO.username} != ${loginMember.username}"
                                                data-bs-toggle="modal"
                                                data-bs-target="#UserBoardSettingModal">···
                                        </button>
                                    </div>
                                </div>
                                <div class="d-flex flex-column border-bottom"
                                     style="height: 67%; overflow-y: auto;">
                                    <div class="d-flex" style="padding: 14px 16px 14px 16px;">
                                        <div class="me-3"
                                             style="position: relative; width: 2rem; height: 2rem;">
                                            <img th:if="${selectFeed.boardDTO.memberDTO.imageDTO == null || selectFeed.boardDTO.memberDTO.imageDTO.name == null || selectFeed.boardDTO.memberDTO.imageDTO.name.isEmpty()}"
                                                 id="none_user_img"
                                                 src="/files/designImg/noneuser.png"
                                                 class="shadow rounded-circle text-center"
                                                 style="position: absolute; top: 0; right: 0; width: 100%; height: 100%; object-fit: cover;">
                                            <img th:unless="${selectFeed.boardDTO.memberDTO.imageDTO == null || selectFeed.boardDTO.memberDTO.imageDTO.name == null || selectFeed.boardDTO.memberDTO.imageDTO.name.isEmpty()}"
                                                 th:src="@{|/resources/${selectFeed.boardDTO.memberDTO.imageDTO.name}|}"
                                                 class="shadow rounded-circle text-center"
                                                 style="position: absolute; top: 0; right: 0; width: 100%; height: 100%; object-fit: cover;">
                                        </div>
                                        <div class="d-flex flex-column">
                                            <div class="d-flex justify-content-start align-items-center"
                                                 style="font-weight:bold;"
                                                 th:text="${selectFeed.boardDTO.memberDTO.username}"></div>
                                            <div class="d-flex justify-content-start align-items-center"
                                                 th:text="${selectFeed.boardDTO.content}"></div>
                                        </div>
                                    </div>
                                    <div th:classappend="${selectFeed.boardDTO.getCommentDisable() == true} ? 'visually-hidden'">
                                        <!-- Comment List -->
                                        <div th:each="comment, loop : ${selectFeed.commentDTOS}">
                                            <div class="d-flex" style="padding: 16px;">
                                                <div class="d-flex justify-content-center align-items-center">
                                                    <div class="me-3"
                                                         style="position: relative; width: 2rem; height: 2rem;">
                                                        <img th:if="${comment.memberDTO.imageDTO == null || comment.memberDTO.imageDTO.name == null || comment.memberDTO.imageDTO.name.isEmpty()}"
                                                             id="none_user_img"
                                                             src="/files/designImg/noneuser.png"
                                                             class="shadow rounded-circle text-center"
                                                             style="position: absolute; top: 0; right: 0; width: 100%; height: 100%; object-fit: cover;">
                                                        <img th:unless="${comment.memberDTO.imageDTO == null || comment.memberDTO.imageDTO.name == null || comment.memberDTO.imageDTO.name.isEmpty()}"
                                                             th:src="@{|/resources/${comment.memberDTO.imageDTO.name}|}"
                                                             class="shadow rounded-circle text-center"
                                                             style="position: absolute; top: 0; right: 0; width: 100%; height: 100%; object-fit: cover;">
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center align-items-center w-100">
                                                    <div class="d-flex flex-column w-100">
                                                        <div class="d-flex mb-2">
                                                            <div class="pe-2"
                                                                 th:text="${comment.memberDTO.username}"
                                                                 th:id="'comment-username' + ${comment.id}"></div>
                                                            <div th:text="${comment.content}"></div>
                                                        </div>
                                                        <div class="d-flex w-80">
                                                            <div class="pe-2 text-dark small"
                                                                 style="width: 30%; font-size: 12px;"
                                                                 th:text="${#temporals.format(comment.createDate, 'MM월dd일 HH:mm')}"></div>
                                                            <div class="pe-2 text-dark small"
                                                                 style="width: 20%; font-size: 12px;"
                                                                 th:text="'좋아요 ' + ${#lists.size(comment.getCommentLikeMemberIds())} + '개'"></div>

                                                            <!--대댓글 달기-->
                                                            <a class="btn btn-sm btn-link text-dark small p-0 pe-2"
                                                               style="width: 20%; font-size: 12px;"
                                                               th:onclick="@{|Comment(${comment.id})|}">답글 달기</a>

                                                            <!-- Button trigger modal -->
                                                            <button type="button"
                                                                    style="font-size: 12px; width: 10%;"
                                                                    class="btn btn-sm btn-link p-0"
                                                                    data-bs-toggle="modal"
                                                                    th:data-id="${comment.id}"
                                                                    th:attr="data-bs-target=(${comment.memberDTO.username} == ${loginMember.username}) ? '#BoardUserCommentModal' : '#UserCommentModal'">
                                                                · · ·
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <a th:href="@{|/comment/like/${comment.id}|}">
                                                        <svg fill="currentColor" width="18"
                                                             height="18" role="img"
                                                             viewBox="0 0 24 24"
                                                             style="color:black;">
                                                            <path d="M16.792 3.904A4.989 4.989 0 0 1 21.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 0 1 4.708-5.218 4.21 4.21 0 0 1 3.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 0 1 3.679-1.938m0-2a6.04 6.04 0 0 0-4.797 2.127 6.052 6.052 0 0 0-4.787-2.127A6.985 6.985 0 0 0 .5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 0 0 3.518 3.018 2 2 0 0 0 2.174 0 45.263 45.263 0 0 0 3.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 0 0-6.708-7.218Z"></path>
                                                        </svg>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="d-flex justify-content-center align-items-center"
                                                 th:if="${#lists.size(comment.recommentDTOS) > 0}"
                                                 th:onclick="@{|ReCommentContainerToggleReplies(${comment.id})|}">
                                                <button class="btn btn-sm btn-link"
                                                        style="display: none;"
                                                        th:id="'recommentContainer-' + ${comment.id}">
                                                    답글 숨기기
                                                </button>
                                                <button class="btn btn-sm btn-link"
                                                        th:id="'recommentCount-' + ${comment.id}"
                                                        th:text="'-----  답글 보기(' + ${#lists.size(comment.recommentDTOS)} + ')'">
                                                </button>
                                            </div>

                                            <div th:id="'repliesContainer-' + ${comment.id}" style="display: none;">
                                                <!-- Comment => Recomment List -->
                                                <div th:each="recomment : ${comment.recommentDTOS}">
                                                    <ul style="margin:0">
                                                        <li class="d-flex" style="padding:10px 16px 0 10px;">
                                                            <div class="me-3"
                                                                 style="position: relative; width: 2rem; height: 2rem;">
                                                                <img th:if="${recomment.memberDTO.imageDTO == null || recomment.memberDTO.imageDTO.name == null || recomment.memberDTO.imageDTO.name.isEmpty()}"
                                                                     id="none_user_img"
                                                                     src="/files/designImg/noneuser.png"
                                                                     class="shadow rounded-circle text-center"
                                                                     style="position: absolute; top: 0; right: 0; width: 100%; height: 100%; object-fit: cover;">
                                                                <img th:unless="${recomment.memberDTO.imageDTO == null || recomment.memberDTO.imageDTO.name == null || recomment.memberDTO.imageDTO.name.isEmpty()}"
                                                                     th:src="@{|/resources/${recomment.memberDTO.imageDTO.name}|}"
                                                                     class="shadow rounded-circle text-center"
                                                                     style="position: absolute; top: 0; right: 0; width: 100%; height: 100%; object-fit: cover;">
                                                            </div>
                                                            <div class="d-flex justify-content-center align-items-center w-100">
                                                                <div class="d-flex flex-column w-100">
                                                                    <div class="d-flex mb-2">
                                                                        <div class="pe-2"
                                                                             th:text="${recomment.memberDTO.username}"
                                                                             th:id="'recomment-username' + ${recomment.id}"></div>
                                                                        <div th:text="${recomment.content}"></div>
                                                                    </div>
                                                                    <div class="d-flex w-80">
                                                                        <div class="pe-2 text-dark small"
                                                                             style="width: 30%; font-size: 12px;"
                                                                             th:text="${#temporals.format(recomment.createDate, 'MM월dd일 HH:mm')}"></div>
                                                                        <div class="pe-2 text-dark small"
                                                                             style="width: 20%; font-size: 12px;"
                                                                             th:text="'좋아요 ' + ${#lists.size(recomment.getRecommentLikeMemberIds())} + '개'"></div>

                                                                        <!--대댓글 달기-->
                                                                        <a class="btn btn-sm btn-link text-dark small p-0 pe-2"
                                                                           style="width: 20%; font-size: 12px;"
                                                                           th:onclick="@{|Recomment(${comment.id}, ${recomment.id})|}">답글
                                                                            달기</a>

                                                                        <!-- Button trigger modal -->
                                                                        <button type="button"
                                                                                style="font-size: 12px; width: 10%;"
                                                                                class="btn btn-sm btn-link p-0"
                                                                                data-bs-toggle="modal"
                                                                                th:data-id="${recomment.id}"
                                                                                th:attr="data-bs-target=(${recomment.memberDTO.username} == ${loginMember.username}) ? '#ReCommentCreateUserModal' : '#ReCommentUserModal'">
                                                                            · · ·
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <a th:href="@{|/recomment/like/${recomment.id}|}">
                                                                <svg fill="currentColor" width="18"
                                                                     height="18" role="img"
                                                                     viewBox="0 0 24 24"
                                                                     style="color:black;">
                                                                    <path d="M16.792 3.904A4.989 4.989 0 0 1 21.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 0 1 4.708-5.218 4.21 4.21 0 0 1 3.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 0 1 3.679-1.938m0-2a6.04 6.04 0 0 0-4.797 2.127 6.052 6.052 0 0 0-4.787-2.127A6.985 6.985 0 0 0 .5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 0 0 3.518 3.018 2 2 0 0 0 2.174 0 45.263 45.263 0 0 0 3.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 0 0-6.708-7.218Z"></path>
                                                                </svg>
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <!-- Recomment List End-->
                                        </div>
                                    </div>
                                </div>
                                <div class="border-bottom" style="height: 13%">
                                    <div class="d-flex flex-column m-1">
                                        <div class="d-flex">
                                            <!--좋아요-->
                                            <div class="p-2" role="button" tabindex="0">
                                                <a th:href="@{|/board/like/${selectFeed.boardDTO.id}|}">
                                                    <svg aria-label="좋아요" fill="currentColor"
                                                         height="24" role="img"
                                                         class="liked-svg" viewBox="0 0 24 24"
                                                         style="color: black;">
                                                        <path d="M16.792 3.904A4.989 4.989 0 0 1 21.5 9.122c0 3.072-2.652 4.959-5.197 7.222-2.512 2.243-3.865 3.469-4.303 3.752-.477-.309-2.143-1.823-4.303-3.752C5.141 14.072 2.5 12.167 2.5 9.122a4.989 4.989 0 0 1 4.708-5.218 4.21 4.21 0 0 1 3.675 1.941c.84 1.175.98 1.763 1.12 1.763s.278-.588 1.11-1.766a4.17 4.17 0 0 1 3.679-1.938m0-2a6.04 6.04 0 0 0-4.797 2.127 6.052 6.052 0 0 0-4.787-2.127A6.985 6.985 0 0 0 .5 9.122c0 3.61 2.55 5.827 5.015 7.97.283.246.569.494.853.747l1.027.918a44.998 44.998 0 0 0 3.518 3.018 2 2 0 0 0 2.174 0 45.263 45.263 0 0 0 3.626-3.115l.922-.824c.293-.26.59-.519.885-.774 2.334-2.025 4.98-4.32 4.98-7.94a6.985 6.985 0 0 0-6.708-7.218Z"></path>
                                                    </svg>
                                                </a>
                                            </div>
                                            <!--댓글-->
                                            <div class="p-2" type="button" tabindex="0"
                                                 data-bs-toggle="modal"
                                                 data-bs-target="#selectFeedModal">
                                                <svg aria-label="댓글 달기" fill="currentColor"
                                                     height="24" width="24" role="img"
                                                     viewBox="0 0 24 24" style="color: black;">
                                                    <path d="M20.656 17.008a9.993 9.993 0 1 0-3.59 3.615L22 22Z"
                                                          fill="none"
                                                          stroke="currentColor"
                                                          stroke-linejoin="round"
                                                          stroke-width="2"></path>
                                                </svg>
                                            </div>
                                            <!--공유-->
                                            <div class="p-2" role="button" tabindex="0">
                                                <svg aria-label="게시물 공유"
                                                     fill="currentColor" height="24" role="img"
                                                     viewBox="0 0 24 24"
                                                     width="24"><title>게시물 공유</title>
                                                    <line fill="none" stroke="currentColor"
                                                          stroke-linejoin="round"
                                                          stroke-width="2" x1="22" x2="9.218"
                                                          y1="3"
                                                          y2="10.083"></line>
                                                    <polygon fill="none"
                                                             points="11.698 20.334 22 3.001 2 3.001 9.218 10.084 11.698 20.334"
                                                             stroke="currentColor"
                                                             stroke-linejoin="round"
                                                             stroke-width="2"></polygon>
                                                </svg>
                                            </div>
                                        </div>
                                        <div class="px-2"
                                             th:text="'좋아요 ' + ${#lists.size(selectFeed.boardDTO().getBoardLikeMemberIds())} + '개'"></div>
                                        <div class="px-2"
                                             th:text="${#temporals.format(selectFeed.boardDTO.getCreateDate(), 'MM월 dd일')}"></div>
                                    </div>
                                </div>
                                <div style="height: 10%">
                                    <div th:classappend="${selectFeed.boardDTO.getCommentDisable() == true}?'visually-hidden'">
                                        <form id="comment-form"
                                              th:action="@{|/comment/create/${selectFeed.boardDTO.id}|}"
                                              method="post"></form>
                                        <form th:action id="recomment-form" method="post"
                                              onsubmit="return false;">
                                            <input type="hidden" id="commentId"
                                                   name="commentId">
                                            <input type="hidden" id="recommentId"
                                                   name="recommentId">
                                        </form>
                                        <div class="d-flex m-2">
                                            <input id="isRecomment" type="hidden">
                                            <textarea class="form-control border-0 me-2"
                                                      style="resize: none;" name="content"
                                                      id="modal-content"
                                                      placeholder="댓글 달기..."></textarea>
                                            <button type="button" style="width: 40px;"
                                                    class="btn btn-link p-0"
                                                    onclick="clickCommentBtn()">게시
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Board Detail Modal End -->

    <!-- CommentSetting Modal -->
    <div class="modal fade" id="CreateUserBoardSettingModal" data-bs-backdrop="static" data-bs-keyboard="false"
         tabindex="-1" aria-labelledby="CreateUserBoardSettingModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div th:if="${selectFeed}">
                    <div class="modal-body p-0">
                        <div class="border-bottom text-center p-2">
                            <a th:href="@{|/beard/delete/${selectFeed.boardDTO.id}|}">
                                <button type="button" class="btn btn-link text-danger">삭제</button>
                            </a>
                        </div>
                        <div class="border-bottom text-center p-2">
                            <a th:href="@{|/board/likehide/${selectFeed.boardDTO.id}|}">
                                <button type="button" th:if="${selectFeed.boardDTO.getLikeHide() == true}"
                                        class="btn btn-link text-dark">좋아요 수 숨기기 취소
                                </button>
                                <button type="button" th:if="${selectFeed.boardDTO.getLikeHide() == false}"
                                        class="btn btn-link text-dark">좋아요 수 숨기기
                                </button>
                            </a>
                        </div>
                        <div class="border-bottom text-center p-2">
                            <a th:href="@{|/board/comment_disable/${selectFeed.boardDTO.id}|}">
                                <button type="button"
                                        th:if="${selectFeed.boardDTO.getCommentDisable() == false}"
                                        class="btn btn-link text-dark">댓글 비활성화
                                </button>
                                <button type="button"
                                        th:if="${selectFeed.boardDTO.getCommentDisable() == true}"
                                        class="btn btn-link text-dark">댓글 활성화
                                </button>
                            </a>
                        </div>
                        <div class="text-center p-2">
                            <button type="button" class="btn btn-link text-dark" data-bs-dismiss="modal">취소
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- CommentSetting Modal End -->

    <!-- CommentSetting Modal -->
    <div class="modal fade" id="UserBoardSettingModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
         aria-labelledby="UserBoardSettingModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div th:if="${selectFeed}">
                    <div class="modal-body p-0">
                        <div class="border-bottom text-center p-2">
                            <button class="btn btn-link text-dark">즐겨찾기 추가</button>
                        </div>
                        <div class="border-bottom text-center p-2">
                            <a th:href="@{|/board/feedMemberInfo/${selectFeed.boardDTO.id}|}">
                                <button class="btn btn-link text-dark">이 계정 정보</button>
                            </a>
                        </div>
                        <div class="border-bottom text-center p-2">
                            <button type="button" class="btn btn-link text-dark" data-bs-dismiss="modal">취소
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- CommentSetting Modal End -->

    <!-- Comment Modal -->
    <div class="modal fade" id="BoardUserCommentModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
         aria-labelledby="BoardUserCommentModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div class="border-bottom text-center p-2">
                        <button type="button" class="btn btn-link text-danger" style="font-weight: bold;">신고</button>
                    </div>
                    <div class="border-bottom text-center p-2">
                        <a class="comment-delete">
                            <button type="button" class="btn btn-link text-danger" style="font-weight: bold;">삭제
                            </button>
                        </a>
                    </div>
                    <div class="border-bottom text-center p-2">
                        <button type="button" class="btn btn-link text-dark" data-bs-dismiss="modal">취소</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Comment Modal End -->


    <!--Comment Modal -->
    <div class="modal fade" id="UserCommentModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
         aria-labelledby="UserCommentModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div class="border-bottom text-center p-2">
                        <button type="button" class="btn btn-link text-danger" style="font-weight: bold;">신고</button>
                    </div>
                    <div class="border-bottom text-center p-2">
                        <button type="button" class="btn btn-link text-dark" data-bs-dismiss="modal">취소</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Comment Modal End -->


    <!-- Recomment Modal -->
    <div class="modal fade" id="ReCommentCreateUserModal" data-bs-backdrop="static" data-bs-keyboard="false"
         tabindex="-1" aria-labelledby="ReCommentCreateUserModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div class="border-bottom text-center p-2">
                        <button type="button" class="btn btn-link text-danger" style="font-weight: bold;">신고</button>
                    </div>
                    <div class="border-bottom text-center p-2">
                        <a class="recomment-delete">
                            <button type="button" class="btn btn-link text-danger" style="font-weight: bold;">삭제
                            </button>
                        </a>
                    </div>
                    <div class="border-bottom text-center p-2">
                        <button type="button" class="btn btn-link text-dark" data-bs-dismiss="modal">취소</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Recomment Modal End -->


    <!--Recomment Modal -->
    <div class="modal fade" id="ReCommentUserModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
         aria-labelledby="ReCommentUserModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body p-0">
                    <div class="border-bottom text-center p-2">
                        <button type="button" class="btn btn-link text-danger" style="font-weight: bold;">신고</button>
                    </div>
                    <div class="border-bottom text-center p-2">
                        <button type="button" class="btn btn-link text-dark" data-bs-dismiss="modal">취소</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Recomment Modal End -->

    <!-- javascript -->
    <script th:inline="javascript">
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

        const selectFeed = /*[[${selectFeed}]]*/ null;
        const myModal = new bootstrap.Modal('#FeedCommentModal', {
            keyboard: true
        })
        if (selectFeed != null) {
            myModal.show();
        }

        document.addEventListener('DOMContentLoaded', function () {
            let commentModals = document.querySelectorAll('.modal');

            commentModals.forEach(function (modal) {
                modal.addEventListener('show.bs.modal', function (event) {
                    const button = event.relatedTarget;
                    const id = button.getAttribute('data-id');
                    console.log(id);

                    const recomment_deleteLink = modal.querySelector('.recomment-delete');
                    const deleteLink = modal.querySelector('.comment-delete');
                    console.log(deleteLink);
                    console.log(recomment_deleteLink);
                    if (deleteLink) {
                        deleteLink.setAttribute('href', '/comment/delete/' + id);
                    } else if (recomment_deleteLink) {
                        recomment_deleteLink.setAttribute('href', '/recomment/delete/' + id);
                    }
                });
            });
        });

        function Comment(id) {
            var commedInput = document.getElementById('commentId');
            commedInput.value = id;

            var user = document.getElementById('comment-username' + id);
            console.log(user);
            var input = document.getElementById('modal-content');
            console.log(input);
            var isRecomment = document.getElementById('isRecomment');

            input.textContent = '@' + user.textContent + " ";
            isRecomment.value = 'true';
        }

        function Recomment(commentId, recommentId) {
            var commedInput = document.getElementById('commentId');
            commedInput.value = commentId;
            var recommedInput = document.getElementById('recommentId');
            recommedInput.value = recommentId;

            var user = document.getElementById('recomment-username' + recommentId);
            console.log(user);
            var input = document.getElementById('modal-content');
            console.log(input);
            var isRecomment = document.getElementById('isRecomment');

            input.textContent = '@' + user.textContent + " ";
            isRecomment.value = 'true';
        }

        function clickCommentBtn() {
            var isRecomment = document.getElementById('isRecomment').value;

            var inputtext = document.getElementById("modal-content").value;
            var formTextEl = document.createElement("textarea");

            formTextEl.setAttribute('hidden', true);
            formTextEl.setAttribute('name', 'content');
            formTextEl.innerHTML = inputtext;

            var form = null;
            if (isRecomment === 'true') {
                form = document.getElementById('recomment-form');

                var recommedInput = document.getElementById('commentId');
                var recommentid = recommedInput.value;
                form.action = '/recomment/create/' + recommentid;
            } else {
                form = document.getElementById('comment-form')
            }
            form.appendChild(formTextEl);
            form.submit();
        }

        function ReCommentContainerToggleReplies(commentId) {
            var repliesContainer = document.getElementById('repliesContainer-' + commentId);
            var viewButton = document.getElementById('recommentContainer-' + commentId);
            var countButton = document.getElementById('recommentCount-' + commentId);

            if (repliesContainer.style.display === 'none') {
                repliesContainer.style.display = 'block';
                viewButton.style.display = 'block';
                countButton.style.display = 'none';
            } else {
                repliesContainer.style.display = 'none';
                viewButton.style.display = 'none';
                countButton.style.display = 'block';
            }
        }

        // 좋아요/좋아요 취소를 토글하는 함수
        function toggleLikeIcon() {
            var likeIcon = document.querySelector('.like');
            var unlikeIcon = document.querySelector('.unlike');

            if (likeIcon.style.display === 'none') {
                likeIcon.style.display = 'block';
                unlikeIcon.style.display = 'none';
            } else {
                likeIcon.style.display = 'none';
                unlikeIcon.style.display = 'block';
            }
        }
    </script>
</div>
</html>