<!DOCTYPE html>
<html layout:decorate="~{Layout/layout_main}">
<head>
    <link rel="stylesheet" type="text/css" th:href="@{/search/search_content.css}">
</head>
<div layout:fragment="content">
    <div class = "search-content">
        <div class = "search-box border mb-3">
            <div class="input-group mb-2">
                <input type="text" class="form-control" placeholder="검색어를 입력해주세요" aria-describedby="basic-addon2" id="keyword" name="keyword" size="15">
            </div>
            <div class = "border" style="height:80vh;">
                <div class="search-list" id="searchList">
                </div>
                <div>
                    현재는 닉네임의 와일드카드(%키워드%) 형태로 <br>
                    검색어 입력시 Local값에 맞게 보여줍니다.(개발중) <br>
                </div>
            </div>
        </div>
    </div>

    <script>


        // 서버에서 받아온 데이터를 리스트 생성
        // 세 가지 분류
        // 1) 데이터형이 계정이라면 계정 프로필 링크 생성 (~/계정아이디)
        // 2) 해시태그라면 explore 페이지 연결, (~/explore/tags/태그명)
        // 3) 장소라면 explore 페이지 연결 (~/explore/locations/장소분류고유번호) openstreetmap 사용


        // 검색창의 변화를 감지하여 완성된 단어를 순서대로 읽어 백엔드로 전달. 실시간으로 검색결과 전송
        $(document).ready(function () {

            var searchListBody = $('#searchList');

            // input 요소에 대한 keyup 이벤트 핸들러 등록
            $("#keyword").keyup(function () {
                // 검색어를 가져오기
                var searchKeyword = $(this).val();

                // 검색어를 이용하여 검색을 수행하고 결과를 표시하는 함수 호출
                SearchKeyword(searchKeyword);
            });


            // 검색창의 변화를 감지하여 완성된 단어를 순서대로 읽어 백엔드로 전달. 실시간으로 검색결과 전송
            function SearchKeyword(keyword) {

                $.ajax({
                    url: '/search/keyword',
                    type: 'GET',
                    dataType: 'json',
                    data: { // 쿼리 문자열로 변환, URL에 포함시켜 서버로 전달.
                        keyword: keyword
                    },
                    success: function (data) {

                        searchListBody.empty();

                        if (keyword.trim() === "") {
                            // 검색어가 비어있을 경우에 대한 처리 (예: 안내 메시지 표시)
                            searchListBody.text('');
                        } else {
                            displaySearchResults(data, keyword);
                        }
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });
            }

            function displaySearchResults(data) {
                var newList = $('<ul></ul>');

                if (data.length > 0) {
                    data.forEach(searchResult => {
                        var listItem = $('<li></li>');
                        listItem.text(searchResult.nickname);
                        newList.append(listItem);
                    });
                } else {
                    var listItem = $('<li></li>');
                    listItem.text('검색 결과가 없습니다.');
                    newList.append(listItem);
                }

                searchListBody.append(newList);
            }

        });

    </script>
</div>
</html>
