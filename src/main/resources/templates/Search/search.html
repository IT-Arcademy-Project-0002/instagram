<!DOCTYPE html>
<html layout:decorate="~{Layout/layout_main}">
<head>
    <link rel="stylesheet" type="text/css" th:href="@{/search/search_content.css}">
</head>
<div layout:fragment="content">
    <div class = "search-content">
        <div class = "search-box border mb-3">
            <div class="input-group mb-2">
                <input type="text" class="form-control" placeholder="검색어를 입력해주세요" aria-describedby="basic-addon2" id="keyword" name="keyword" size="15">
            </div>
            <div class = "border" style="height:80vh;">
                <div class="search-list" id="searchList">
                </div>
            </div>
        </div>
    </div>

    <script>

        // 해시태그 입력란이 따로 있던가...? 아니면 #을 붙였을때는 음.. 어절의 시작에 #이 붙은 것을 대상으로 검색

        // 검색창의 변화를 감지하여 완성된 단어를 순서대로 읽어 백엔드로 전달. 실시간으로 검색결과 전송
        $(document).ready(function () {

            var searchListBody = $('#searchList');

            // input 요소에 대한 keyup 이벤트 핸들러 등록
            $("#keyword").keyup(function () {
                // 검색어를 가져오기
                var searchKeyword = $(this).val();

                // 검색어를 이용하여 검색을 수행하고 결과를 표시하는 함수 호출
                SearchKeyword(searchKeyword);
            });


            // 검색창의 변화를 감지하여 완성된 단어를 순서대로 읽어 백엔드로 전달. 실시간으로 검색결과 전송
            function SearchKeyword(keyword) {

                $.ajax({
                    url: '/search/keyword',
                    type: 'GET',
                    dataType: 'json',
                    data: { // 쿼리 문자열로 변환, URL에 포함시켜 서버로 전달.
                        keyword: keyword
                    },
                    success: function (data) {

                        searchListBody.empty();

                        if (keyword.trim() === "") {
                            // 검색어가 비어있을 경우에 대한 처리 (예: 안내 메시지 표시)
                            searchListBody.text('');
                        } else {
                            displaySearchResults(data, keyword);
                        }
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });
            }

            function displaySearchResults(data) {
                var newList = $('<div></div>');

                if (data.length > 0) {
                    data.forEach(searchResult => {
                        var listItem = $(

                            '<div class="row p-3">' +
                            '<div class="col-sm-2">' +
                            '<img src="/files/designImg/noneuser.png" class="img-fluid rounded float-start" style="height: 3rem;">' +
                            '</div>' +
                            '<div class="col-sm-10">' +
                            '<div class="fw-bold mb-3"><a href="/member/page/'+ searchResult.username + '" target="_blank" class="link">' + searchResult.username + '</a></div>' +
                            '</div>' +
                            '</div>'

                        );
                        newList.append(listItem);
                    });
                } else {
                    var listItem = $('<div></div>');
                    listItem.text('검색 결과가 없습니다.');
                    newList.append(listItem);
                }

                searchListBody.append(newList);
            }

        });

    </script>
</div>
</html>
